<tree-view id="menu"></tree-view>
<x-sidebar></x-sidebar>
<script>
  class TreeView extends HTMLElement {
    constructor() {
        super();
        this.attachShadow({ mode: 'open' });
    }

    renderList(children, parentElement = this.shadowRoot) {
        const ul = document.createElement('ul');
        children.forEach(child => {
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.textContent = child.title;
            child.href && (a.href = child.href);
            child.onClick && (a.onclick = child.onClick);
            li.appendChild(a);
            
            li.addEventListener('click', e => {
                e.preventDefault();
                e.stopPropagation(); // 阻止事件冒泡
                li.classList.toggle('open');
            });

            if (child.children) {
                this.renderList(child.children, li);
            }
            ul.appendChild(li);
        });
        parentElement.appendChild(ul);
    }

    set data(value) {
        if (this.shadowRoot) {
            this.shadowRoot.innerHTML = `
                <style>
                    li > ul {
                        display: none;
                    }
                    li {
                        list-style-type: disclosure-closed;
                    }
                    li.open {
                        list-style-type: disclosure-open;
                    }
                    li.open > ul {
                        display: block;
                    }
                </style>
            `;
            this.renderList(value);
        }
    }
}

customElements.define('tree-view', TreeView);

  class SidebarComponent extends HTMLElement {
    constructor() {
      super();
      this.attachShadow({ mode: 'open' });
    }
    render({ title, children = [] } = {}) {
      const template = document.createElement('template');
      template.innerHTML = `
        <style>
          @import url(../sidebar.css);
        </style>
        <aside class="sidebar" >
          <h3>${title}</h3>
          <tree-view></tree-view>
        </aside>
      `;
      this.shadowRoot.appendChild(template.content.cloneNode(true));
      const menu = this.shadowRoot.querySelector('tree-view');
      menu.data = children;
    }
    set data(value) {
      this.render(value);
    }
  }

  customElements.define('x-sidebar', SidebarComponent);

  const data = {
    title: 'Sidebar',
    children: [
      { title: 'Link 1' },
      { title: 'Link 2' },
      { title: 'Link 3' },
      {
        title: 'Link 4',
        children: [
          { title: 'Link 4.1' },
          { title: 'Link 4.2' },
        ]
      },
      { title: 'Link 5' },
      { title: 'Link 6' },
      { title: 'Link 7' },
      { title: 'Link 8' },
      { title: 'Link 5' },
      { title: 'Link 6' },
      { title: 'Link 7' },
      { title: 'Link 8' },
    ],
  };

  const sidebar = document.querySelector('x-sidebar');
  sidebar.data = data;

  // const menu = document.querySelector('tree-view');
  // menu.data = data;
</script>